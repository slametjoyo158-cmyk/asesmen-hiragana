<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesmen Pengenalan Hiragana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 800px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            transition: transform 0.3s ease;
        }
        .card-menu {
            @apply cursor-pointer transition-all duration-300 transform hover:scale-105;
        }
        .option-button {
            @apply w-full text-left p-4 my-2 border-2 border-gray-200 rounded-lg transition-all duration-200 hover:bg-indigo-50 hover:border-indigo-400 font-medium;
        }
        .option-button.correct {
            @apply bg-green-100 border-green-500;
        }
        .option-button.incorrect {
            @apply bg-red-100 border-red-500;
        }
        .option-button.disabled {
            @apply pointer-events-none;
        }
        .feedback-message {
            @apply mt-4 p-3 rounded-lg text-sm font-semibold;
        }
        .feedback-correct {
            @apply bg-green-500 text-white;
        }
        .feedback-incorrect {
            @apply bg-red-500 text-white;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="container mx-auto">

        <!-- Halaman Login -->
        <div id="login-page" class="page hidden">
            <div class="card">
                <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Asesmen Hiragana</h1>
                <p class="text-center text-gray-600 mb-8">Silakan masukkan nama Anda untuk memulai.</p>
                <input type="text" id="username-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 mb-6" placeholder="Nama Anda" required>
                <button id="login-button" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-150">Masuk</button>
                <p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden">Nama tidak boleh kosong.</p>
            </div>
        </div>

        <!-- Halaman Beranda -->
        <div id="home-page" class="page hidden">
            <div class="card text-center">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Selamat Datang, <span id="welcome-username" class="text-indigo-600"></span>!</h1>
                <p class="text-gray-600 mb-8">Pilih menu di bawah untuk memulai asesmen atau melihat riwayat skor.</p>

                <div class="grid md:grid-cols-2 gap-6">
                    <div id="start-quiz-menu" class="card-menu card p-6 bg-indigo-50 border-indigo-200 border-t-4 border-l-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-600 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-4 0V3h4v2m-4 0h4m-4 0v2m-4-2H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-4 0V3h4v2" />
                        </svg>
                        <h2 class="text-xl font-semibold text-gray-800">Mulai Asesmen</h2>
                        <p class="text-gray-500 text-sm mt-1">Total 40 Soal. (Termasuk 10 Soal Kepemilikan)</p>
                    </div>

                    <div id="show-scores-menu" class="card-menu card p-6 bg-green-50 border-green-200 border-t-4 border-l-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-600 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0h6"/>
                        </svg>
                        <h2 class="text-xl font-semibold text-gray-800">Riwayat Skor</h2>
                        <p class="text-gray-500 text-sm mt-1">Lihat hasil asesmen Anda sebelumnya.</p>
                    </div>
                </div>

                <button id="logout-button" class="mt-8 text-sm text-gray-500 hover:text-red-600 transition duration-150">Keluar</button>
            </div>
        </div>

        <!-- Halaman Kuis -->
        <div id="quiz-page" class="page hidden">
            <div class="card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Asesmen Hiragana</h2>
                <div class="mb-4 flex justify-between items-center">
                    <span class="text-lg font-medium text-indigo-600" id="quiz-progress">Soal 1 dari 40</span>
                    <span class="text-lg font-medium text-gray-700">Skor: <span id="current-score">0</span></span>
                </div>

                <div id="question-container" class="border-t pt-4">
                    <p class="text-xl font-semibold mb-6" id="question-text"></p>
                    <div id="options-container">
                        <!-- Pilihan Jawaban akan dimasukkan di sini -->
                    </div>
                    <div id="feedback-message" class="feedback-message hidden"></div>
                    <button id="next-button" class="mt-6 w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-150" disabled>Lanjut</button>
                </div>
            </div>
        </div>

        <!-- Halaman Hasil -->
        <div id="result-page" class="page hidden">
            <div class="card text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Hasil Asesmen Selesai!</h2>
                <p class="text-lg text-gray-700 mb-6">Selamat, <span id="result-username"></span>, Anda telah menyelesaikan asesmen.</p>

                <div class="bg-indigo-50 p-6 rounded-lg mb-8">
                    <p class="text-xl text-gray-600">Skor Akhir Anda:</p>
                    <p class="text-5xl font-extrabold text-indigo-600 mt-2" id="final-score-display"></p>
                    <p class="text-lg text-gray-600 mt-2"><span id="correct-count"></span> Jawaban Benar dari 40 Soal</p>
                </div>

                <button id="back-to-home-button" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-150">Kembali ke Beranda</button>
            </div>
        </div>

        <!-- Halaman Riwayat Skor -->
        <div id="scores-page" class="page hidden">
            <div class="card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Riwayat Skor Asesmen</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Kuis</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Skor</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                            </tr>
                        </thead>
                        <tbody id="scores-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Riwayat skor akan dimasukkan di sini -->
                        </tbody>
                    </table>
                </div>
                <button id="back-from-scores-button" class="mt-6 w-full bg-gray-300 text-gray-800 p-3 rounded-lg font-semibold hover:bg-gray-400 transition duration-150">Kembali</button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginPage = document.getElementById('login-page');
            const homePage = document.getElementById('home-page');
            const quizPage = document.getElementById('quiz-page');
            const resultPage = document.getElementById('result-page');
            const scoresPage = document.getElementById('scores-page');

            const usernameInput = document.getElementById('username-input');
            const loginButton = document.getElementById('login-button');
            const loginError = document.getElementById('login-error');
            const welcomeUsername = document.getElementById('welcome-username');
            const logoutButton = document.getElementById('logout-button');
            const startQuizMenu = document.getElementById('start-quiz-menu');
            const showScoresMenu = document.getElementById('show-scores-menu');
            const scoresTableBody = document.getElementById('scores-table-body');
            const backFromScoresButton = document.getElementById('back-from-scores-button');

            const quizProgress = document.getElementById('quiz-progress');
            const currentScoreDisplay = document.getElementById('current-score');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const feedbackMessage = document.getElementById('feedback-message');
            const nextButton = document.getElementById('next-button');

            const resultUsername = document.getElementById('result-username');
            const finalScoreDisplay = document.getElementById('final-score-display');
            const correctCountDisplay = document.getElementById('correct-count');
            const backToHomeButton = document.getElementById('back-to-home-button');

            let currentQuestionIndex = 0;
            let currentScore = 0;
            let correctAnswersCount = 0;
            let currentQuizTitle = "Asesmen Hiragana";

            // --- DATA SOAL BARU (Total 40 Soal) ---
            const questions = [
                // 10 Soal Hiragana Recognition (Karakter ke Sebutan)
                { q: "Apa sebutan untuk karakter: あ", type: "recognition", options: ["i", "e", "a", "u"], answer: "a" },
                { q: "Apa sebutan untuk karakter: き", type: "recognition", options: ["chi", "ki", "ku", "ko"], answer: "ki" },
                { q: "Apa sebutan untuk karakter: す", type: "recognition", options: ["shi", "sa", "su", "se"], answer: "su" },
                { q: "Apa sebutan untuk karakter: て", type: "recognition", options: ["to", "ta", "tsu", "te"], answer: "te" },
                { q: "Apa sebutan untuk karakter: な", type: "recognition", options: ["nu", "ni", "no", "na"], answer: "na" },
                { q: "Apa sebutan untuk karakter: は", type: "recognition", options: ["he", "ho", "ha", "hi"], answer: "ha" },
                { q: "Apa sebutan untuk karakter: ま", type: "recognition", options: ["mo", "mi", "me", "ma"], answer: "ma" },
                { q: "Apa sebutan untuk karakter: や", type: "recognition", options: ["yo", "yu", "ya", "i"], answer: "ya" },
                { q: "Apa sebutan untuk karakter: り", type: "recognition", options: ["ru", "re", "ro", "ri"], answer: "ri" },
                { q: "Apa sebutan untuk karakter: を", type: "recognition", options: ["o (partikel)", "n", "wa", "mo"], answer: "o (partikel)" },

                // 10 Soal Hiragana Recognition (Sebutan ke Karakter)
                { q: "Pilih karakter untuk 'o'", type: "recognition", options: ["あ", "い", "う", "お"], answer: "お" },
                { q: "Pilih karakter untuk 'shi'", type: "recognition", options: ["さ", "し", "す", "せ"], answer: "し" },
                { q: "Pilih karakter untuk 'ko'", type: "recognition", options: ["か", "き", "く", "こ"], answer: "こ" },
                { q: "Pilih karakter untuk 'tsu'", type: "recognition", options: ["た", "ち", "つ", "て"], answer: "つ" },
                { q: "Pilih karakter untuk 'nu'", type: "recognition", options: ["な", "に", "ぬ", "ね"], answer: "ぬ" },
                { q: "Pilih karakter untuk 'fu'", type: "recognition", options: ["は", "ひ", "ふ", "へ"], answer: "ふ" },
                { q: "Pilih karakter untuk 'me'", type: "recognition", options: ["ま", "み", "む", "め"], answer: "め" },
                { q: "Pilih karakter untuk 'yu'", type: "recognition", options: ["や", "ゆ", "よ", "ら"], answer: "ゆ" },
                { q: "Pilih karakter untuk 'wa'", type: "recognition", options: ["ら", "わ", "を", "ん"], answer: "わ" },
                { q: "Pilih karakter untuk 'n'", type: "recognition", options: ["を", "ん", "ろ", "る"], answer: "ん" },
                
                // 10 Soal Kepemilikan Benda (Grammar/Sentence Check) - Sesuai permintaan
                { q: "Apa arti dari kalimat: **これは だれの ぺん ですか？**", type: "grammar", options: ["Apakah ini pensil?", "Dimana pulpen saya?", "Pulpen ini milik siapa?", "Berapa harga pulpen ini?"], answer: "Pulpen ini milik siapa?" },
                { q: "Kalimat yang tepat untuk menjawab: **それは わたしの ほん です。**", type: "grammar", options: ["Bukan, itu buku saya.", "Ya, itu buku saya.", "Buku itu ada di sekolah.", "Dimana buku kamu?"], answer: "Ya, itu buku saya." },
                { q: "Kata yang tepat untuk mengisi titik-titik: **あれは せんせい ( ___ ) かばん です。**", type: "grammar", options: ["を", "は", "の", "が"], answer: "の" },
                { q: "Arti dari: **やまもとさん の じしょ は どれ ですか？**", type: "grammar", options: ["Siapa nama Yamamoto?", "Dimana Yamamoto-sensei?", "Yang mana kamus milik Yamamoto-san?", "Apakah ini kamus Yamamoto-san?"], answer: "Yang mana kamus milik Yamamoto-san?" },
                { q: "Jika A bertanya: **これは あなた の けしゴム ですか？** Jawaban B yang membenarkan kepemilikan:", type: "grammar", options: ["いいえ、ちがいます。", "はい、わたし の です。", "はい、がっこう の です。", "いいえ、だれ の ですか。"], answer: "はい、わたし の です。" },
                { q: "Terjemahan dari: **Itu adalah tas milik kakak perempuan saya.**", type: "grammar", options: ["あれは おかあさん の かばん です。", "これ は おにいさん の かばん です。", "それ は あね の かばん です。", "これ は いもうと の かばん です。"], answer: "それ は あね の かばん です。" },
                { q: "Kalimat Hiragana yang menanyakan kepemilikan: **Pilih yang benar.**", type: "grammar", options: ["それは どこ ですか？", "なんさい ですか？", "だれ の くるま ですか？", "これは いくら ですか？"], answer: "だれ の くるま ですか？" },
                { q: "Kalimat **わたし の とけい** berarti:", type: "grammar", options: ["Kamu punya jam", "Jam milikku", "Jam itu besar", "Dimana jam itu?"], answer: "Jam milikku" },
                { q: "Jika benda itu **BUKAN** milik siswa, bagaimana kalimat jawabannya:", type: "grammar", options: ["はい、わたし の です。", "いいえ、ちがいます。", "そうです。", "あれは だれ の ですか。"], answer: "いいえ、ちがいます。" },
                { q: "Partikel yang digunakan untuk menunjukkan kepemilikan benda adalah:", type: "grammar", options: ["は (wa)", "が (ga)", "も (mo)", "の (no)"], answer: "の (no)" },

                // 10 Soal Hiragana Word Recognition (Kata ke Arti)
                { q: "Apa arti dari kata: **さかな**", type: "word_recognition", options: ["Daging", "Ikan", "Sayur", "Nasi"], answer: "Ikan" },
                { q: "Apa arti dari kata: **せんせい**", type: "word_recognition", options: ["Murid", "Teman", "Guru", "Ayah"], answer: "Guru" },
                { q: "Apa arti dari kata: **やま**", type: "word_recognition", options: ["Laut", "Sungai", "Gunung", "Batu"], answer: "Gunung" },
                { q: "Apa arti dari kata: **くつ**", type: "word_recognition", options: ["Topi", "Baju", "Sepatu", "Celana"], answer: "Sepatu" },
                { q: "Apa arti dari kata: **みず**", type: "word_recognition", options: ["Air", "Api", "Udara", "Tanah"], answer: "Air" },
                { q: "Apa arti dari kata: **ふゆ**", type: "word_recognition", options: ["Musim semi", "Musim panas", "Musim gugur", "Musim dingin"], answer: "Musim dingin" },
                { q: "Apa arti dari kata: **ちいさい**", type: "word_recognition", options: ["Besar", "Kecil", "Panjang", "Pendek"], answer: "Kecil" },
                { q: "Apa arti dari kata: **おちゃ**", type: "word_recognition", options: ["Kopi", "Jus", "Teh", "Susu"], answer: "Teh" },
                { q: "Apa arti dari kata: **げんき**", type: "word_recognition", options: ["Lelah", "Sedih", "Sehat/Semangat", "Marah"], answer: "Sehat/Semangat" },
                { q: "Apa arti dari kata: **かぎ**", type: "word_recognition", options: ["Pintu", "Jendela", "Kunci", "Meja"], answer: "Kunci" },

            ];
            // --- AKHIR DATA SOAL ---


            function showPage(pageId) {
                const pages = [loginPage, homePage, quizPage, resultPage, scoresPage];
                pages.forEach(page => page.classList.add('hidden'));

                switch(pageId) {
                    case 'login':
                        loginPage.classList.remove('hidden');
                        break;
                    case 'home':
                        homePage.classList.remove('hidden');
                        break;
                    case 'quiz':
                        quizPage.classList.remove('hidden');
                        break;
                    case 'result':
                        resultPage.classList.remove('hidden');
                        break;
                    case 'scores':
                        scoresPage.classList.remove('hidden');
                        break;
                }
            }

            // Fungsi untuk mengacak urutan elemen dalam array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // --- Logika Login dan Logout ---
            loginButton.addEventListener('click', () => {
                const username = usernameInput.value.trim();
                if (username) {
                    sessionStorage.setItem('loggedInUser', username);
                    welcomeUsername.textContent = username;
                    showPage('home');
                    loginError.classList.add('hidden');
                } else {
                    loginError.classList.remove('hidden');
                }
            });

            logoutButton.addEventListener('click', () => {
                sessionStorage.removeItem('loggedInUser');
                usernameInput.value = '';
                showPage('login');
            });

            // --- Logika Kuis ---
            startQuizMenu.addEventListener('click', startQuiz);
            backToHomeButton.addEventListener('click', () => showPage('home'));

            function startQuiz() {
                // Acak urutan soal sebelum memulai
                shuffleArray(questions);
                
                currentQuestionIndex = 0;
                currentScore = 0;
                correctAnswersCount = 0;
                currentQuizTitle = "Asesmen Hiragana";
                currentScoreDisplay.textContent = currentScore;
                
                showPage('quiz');
                loadQuestion();
            }

            function loadQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    finishQuiz();
                    return;
                }

                const questionData = questions[currentQuestionIndex];
                
                // Reset UI
                optionsContainer.innerHTML = '';
                feedbackMessage.classList.add('hidden');
                feedbackMessage.classList.remove('feedback-correct', 'feedback-incorrect');
                nextButton.disabled = true;

                // Update Progress
                quizProgress.textContent = `Soal ${currentQuestionIndex + 1} dari ${questions.length}`;
                questionText.innerHTML = `${currentQuestionIndex + 1}. ${questionData.q}`;

                // Acak dan Tampilkan Pilihan Jawaban
                let shuffledOptions = [...questionData.options];
                shuffleArray(shuffledOptions);
                
                shuffledOptions.forEach(optionText => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = optionText;
                    button.dataset.answer = optionText;
                    button.addEventListener('click', () => selectAnswer(button, questionData.answer));
                    optionsContainer.appendChild(button);
                });
            }

            function selectAnswer(selectedButton, correctAnswer) {
                const isCorrect = selectedButton.dataset.answer === correctAnswer;
                const allButtons = optionsContainer.querySelectorAll('.option-button');

                // Disable semua tombol setelah jawaban dipilih
                allButtons.forEach(btn => {
                    btn.classList.add('disabled');
                    if (btn.dataset.answer === correctAnswer) {
                        btn.classList.add('correct');
                    }
                    if (btn === selectedButton && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                });

                // Tampilkan Feedback
                if (isCorrect) {
                    currentScore += 100 / questions.length; // Bobot skor dibagi rata
                    correctAnswersCount++;
                    feedbackMessage.textContent = "Jawaban Tepat! Lanjut ke soal berikutnya.";
                    feedbackMessage.classList.add('feedback-correct');
                } else {
                    feedbackMessage.textContent = `Jawaban salah. Jawaban yang benar adalah: ${correctAnswer}`;
                    feedbackMessage.classList.add('feedback-incorrect');
                }
                
                currentScoreDisplay.textContent = Math.round(currentScore);
                feedbackMessage.classList.remove('hidden');
                nextButton.disabled = false;
                nextButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            nextButton.addEventListener('click', () => {
                currentQuestionIndex++;
                loadQuestion();
            });

            function finishQuiz() {
                const finalScore = Math.round(currentScore);
                const username = sessionStorage.getItem('loggedInUser');

                // Simpan skor
                saveScore(currentQuizTitle, finalScore, correctAnswersCount);

                // Tampilkan Hasil
                resultUsername.textContent = username;
                finalScoreDisplay.textContent = finalScore;
                correctCountDisplay.textContent = correctAnswersCount;
                showPage('result');
            }

            // --- Logika Riwayat Skor ---

            // Fungsi untuk menyimpan skor ke localStorage
            function saveScore(title, finalScore, correctCount) {
                const scores = JSON.parse(localStorage.getItem('hiraganaScores')) || [];
                const date = new Date().toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                scores.unshift({ title, score: finalScore, correct: correctCount, total: questions.length, date });
                
                // Batasi jumlah riwayat skor yang disimpan
                if (scores.length > 10) {
                    scores.pop(); 
                }
                
                localStorage.setItem('hiraganaScores', JSON.stringify(scores));
            }

            // Fungsi untuk menampilkan riwayat skor
            function showScores() {
                const scores = JSON.parse(localStorage.getItem('hiraganaScores')) || [];
                scoresTableBody.innerHTML = '';
                
                if (scores.length > 0) {
                    scores.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap">${entry.title}</td><td class="px-6 py-4 whitespace-nowrap font-bold text-indigo-600">${entry.score} <span class="text-sm text-gray-500">(${entry.correct}/${entry.total})</span></td><td class="px-6 py-4 whitespace-nowrap">${entry.date}</td>`;
                        scoresTableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-gray-500">Belum ada skor yang tercatat.</td>`;
                    scoresTableBody.appendChild(row);
                }
                
                showPage('scores');
            }

            showScoresMenu.addEventListener('click', showScores);
            backFromScoresButton.addEventListener('click', () => showPage('home'));

            // Cek status login saat halaman dimuat
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            if (loggedInUser) {
                welcomeUsername.textContent = loggedInUser;
                showPage('home');
            } else {
                showPage('login');
            }
        });
    </script>
</body>
</html>
