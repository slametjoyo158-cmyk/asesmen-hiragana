<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesmen Pengenalan Hiragana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 800px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-menu {
            @apply cursor-pointer transition-all duration-300 transform hover:scale-105;
        }
        .card-menu:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .kanji-display {
            font-size: 4rem;
            color: #4a5568;
            transition: color 0.3s ease;
        }
        .kanji-display:hover {
            color: #2d3748;
        }
        /* Custom style untuk progress bar timer */
        #timer-progress {
            transition: width 0.1s linear;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div id="app" class="container mx-auto">

        <!-- Halaman Login -->
        <div id="login-page" class="card space-y-6">
            <h1 class="text-3xl font-bold text-center text-gray-800">Login Asesmen Hiragana</h1>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="block text-gray-700 font-semibold">Username:</label>
                    <input type="text" id="username" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2" placeholder="Masukkan username Anda" required>
                </div>
                <div>
                    <label for="nis" class="block text-gray-700 font-semibold">NIS:</label>
                    <input type="text" id="nis" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2" placeholder="Masukkan NIS Anda" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-md font-bold hover:bg-blue-700 transition duration-300">Login</button>
            </form>
        </div>

        <!-- Halaman Beranda -->
        <div id="home-page" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">Selamat Datang, <span id="user-name"></span>!</h1>
                <div class="flex gap-2 mt-4 md:mt-0">
                    <button id="view-scores-button" class="bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 transition duration-300">Riwayat Skor</button>
                    <button id="logout-button" class="bg-red-500 text-white p-2 rounded-md hover:bg-red-600 transition duration-300">Logout</button>
                </div>
            </div>
            
            <p class="text-lg text-gray-600 mb-8">Pilih bagian yang ingin Anda pelajari:</p>

            <!-- Menyesuaikan grid menjadi 2 kolom untuk 6 item menu -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6"> 
                <div class="card card-menu p-6 text-center bg-yellow-200" data-page="part1">
                    <h2 class="text-xl font-bold text-gray-700">Bagian 1</h2>
                    <p class="text-gray-600 mt-2">Mengenal A, I, U, E, O dan KA, KI, KU, KE, KO</p>
                </div>
                <div class="card card-menu p-6 text-center bg-green-200" data-page="part2">
                    <h2 class="text-xl font-bold text-gray-700">Bagian 2</h2>
                    <p class="text-gray-600 mt-2">Mengenal SA, SI, SU, SE, SO dan TA, CHI, TSU, TE, TO</p>
                </div>
                <div class="card card-menu p-6 text-center bg-blue-200" data-page="part3">
                    <h2 class="text-xl font-bold text-gray-700">Bagian 3</h2>
                    <p class="text-gray-600 mt-2">Mengenal NA, NI, NU, NE, NO dan HA, HI, FU, HE, HO</p>
                </div>
                <div class="card card-menu p-6 text-center bg-purple-200" data-page="part4">
                    <h2 class="text-xl font-bold text-gray-700">Bagian 4</h2>
                    <p class="text-gray-600 mt-2">Mengenal R-Series, M-Series, WA, WO, N</p>
                </div>
                <div class="card card-menu p-6 text-center bg-pink-200" data-page="part5">
                    <h2 class="text-xl font-bold text-gray-700">Bagian 5</h2>
                    <p class="text-gray-600 mt-2">Mengenal Dakuon dan Handokuon</p>
                </div>
                <!-- BOX MENU BARU: Bagian 6 untuk PSAS GASAL -->
                <div class="card card-menu p-6 text-center bg-red-300" data-page="part6">
                    <h2 class="text-xl font-bold text-gray-800">Bagian 6</h2>
                    <p class="text-gray-700 font-semibold mt-2">PSAS GASAL BAHASA JEPANG</p>
                </div>
                <!-- Akhir BOX MENU BARU -->
            </div>
        </div>
        
        <!-- Halaman Riwayat Skor -->
        <div id="scores-page" class="hidden card space-y-4">
            <h1 class="text-3xl font-bold text-center text-gray-800">Riwayat Skor</h1>
            <table class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr>
                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bagian</th>
                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Skor</th>
                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                    </tr>
                </thead>
                <tbody id="scores-table-body" class="bg-white divide-y divide-gray-200">
                    <!-- Skor akan dimasukkan di sini oleh JS -->
                </tbody>
            </table>
            <button id="back-from-scores" class="w-full mt-8 bg-gray-500 text-white p-3 rounded-md font-bold hover:bg-gray-600 transition duration-300">Kembali ke Beranda</button>
        </div>

        <!-- Halaman Bagian (Template) -->
        <div id="part-page-template" class="hidden card space-y-6">
            <h1 id="part-title" class="text-3xl font-bold text-center text-gray-800 mb-6"></h1>
            
            <!-- Pengenalan Karakter -->
            <h2 class="text-2xl font-bold text-gray-700 mb-4">Pengenalan Karakter</h2>
            <div id="hiragana-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-8">
                <!-- Karakter akan dimasukkan di sini oleh JS -->
            </div>
            
            <!-- Pengenalan Kata -->
            <h2 class="text-2xl font-bold text-gray-700 mb-4">Pengenalan Kata</h2>
            <div id="word-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <!-- Kata-kata akan dimasukkan di sini oleh JS -->
            </div>
            
            <!-- Tombol Mulai Kuis -->
            <button id="start-quiz-button" class="w-full bg-green-500 text-white p-3 rounded-md font-bold hover:bg-green-600 transition duration-300">Mulai Kuis</button>

            <button id="back-to-home-part" class="w-full mt-4 bg-gray-500 text-white p-3 rounded-md font-bold hover:bg-gray-600 transition duration-300">Kembali ke Beranda</button>
        </div>

        <!-- Halaman Kuis -->
        <div id="quiz-page" class="hidden card space-y-6">
            <h1 id="quiz-title" class="text-3xl font-bold text-center text-gray-800"></h1>
            
            <!-- Area Timer Baru -->
            <div id="timer-bar" class="w-full bg-gray-200 rounded-full h-4 relative">
                <div id="timer-progress" class="h-4 bg-red-500 rounded-full transition-all duration-100 ease-linear" style="width: 100%;"></div>
            </div>
            <p id="timer-display" class="text-xl font-bold text-red-600 text-center">20 detik tersisa</p>
            <!-- Akhir Area Timer Baru -->

            <div id="quiz-content" class="space-y-4">
                <p id="question-text" class="text-xl font-bold text-gray-800 text-center"></p>
                <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Pilihan jawaban akan dimasukkan di sini oleh JS -->
                </div>
            </div>
            <div id="quiz-result" class="hidden text-center">
                <p class="text-2xl font-bold text-gray-800">Skor Anda:</p>
                <p id="score-display" class="text-4xl font-extrabold text-blue-600 mt-2"></p>
                <button id="back-from-quiz" class="w-full mt-8 bg-gray-500 text-white p-3 rounded-md font-bold hover:bg-gray-600 transition duration-300">Kembali ke Beranda</button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginPage = document.getElementById('login-page');
            const loginForm = document.getElementById('login-form');
            const homePage = document.getElementById('home-page');
            const userName = document.getElementById('user-name');
            const logoutButton = document.getElementById('logout-button');
            const viewScoresButton = document.getElementById('view-scores-button');
            const scoresPage = document.getElementById('scores-page');
            const scoresTableBody = document.getElementById('scores-table-body');
            const backFromScoresButton = document.getElementById('back-from-scores');
            
            const partPageTemplate = document.getElementById('part-page-template');
            const quizPage = document.getElementById('quiz-page');
            const quizTitle = document.getElementById('quiz-title');
            const quizContent = document.getElementById('quiz-content');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const quizResult = document.getElementById('quiz-result');
            const scoreDisplay = document.getElementById('score-display');
            const backFromQuizButton = document.getElementById('back-from-quiz');
            
            const startQuizButton = document.getElementById('start-quiz-button');
            const backToHomePartButton = document.getElementById('back-to-home-part');

            // Variabel Kuis dan Timer
            let currentQuizData = null;
            let currentQuizIndex = 0;
            let correctAnswers = 0; // Menggunakan ini untuk menghitung skor akhir
            let timerInterval = null;
            const QUESTION_DURATION = 20; // 20 detik durasi soal

            const pages = {
                login: loginPage,
                home: homePage,
                scores: scoresPage,
                part: partPageTemplate,
                quiz: quizPage
            };

            const hiraganaData = {
                part1: {
                    title: 'Bagian 1: Hiragana Vokal dan K-Series',
                    chars: { 'あ': 'a', 'い': 'i', 'う': 'u', 'え': 'e', 'お': 'o', 'か': 'ka', 'き': 'ki', 'く': 'ku', 'け': 'ke', 'こ': 'ko' },
                    words: [
                        { hiragana: 'あかい', romaji: 'akai', meaning: 'Merah' },
                        { hiragana: 'いき', romaji: 'iki', meaning: 'Nafas' },
                        { hiragana: 'うま', romaji: 'uma', meaning: 'Kuda' },
                        { hiragana: 'かさ', romaji: 'kasa', meaning: 'Payung' },
                        { hiragana: 'こえ', romaji: 'koe', meaning: 'Suara' },
                        { hiragana: 'えき', romaji: 'eki', meaning: 'Stasiun' },
                        { hiragana: 'おかし', romaji: 'okashi', meaning: 'Permen' },
                        { hiragana: 'かき', romaji: 'kaki', meaning: 'Buah kesemek' },
                        { hiragana: 'くち', romaji: 'kuchi', meaning: 'Mulut' },
                        { hiragana: 'けい', romaji: 'kei', meaning: 'Tipe' }
                    ]
                },
                part2: {
                    title: 'Bagian 2: Hiragana S-Series dan T-Series',
                    chars: { 'さ': 'sa', 'し': 'shi', 'す': 'su', 'せ': 'se', 'そ': 'so', 'た': 'ta', 'ち': 'chi', 'つ': 'tsu', 'て': 'te', 'と': 'to' },
                    words: [
                        { hiragana: 'さかな', romaji: 'sakana', meaning: 'Ikan' },
                        { hiragana: 'しお', romaji: 'shio', meaning: 'Garam' },
                        { hiragana: 'すし', romaji: 'sushi', meaning: 'Sushi' },
                        { hiragana: 'せかい', romaji: 'sekai', meaning: 'Dunia' },
                        { hiragana: 'そと', romaji: 'soto', meaning: 'Luar' },
                        { hiragana: 'たけ', romaji: 'take', meaning: 'Bambu' },
                        { hiragana: 'ちかてつ', romaji: 'chikatetsu', meaning: 'Kereta bawah tanah' },
                        { hiragana: 'つる', romaji: 'tsuru', meaning: 'Burung bangau' },
                        { hiragana: 'てがみ', romaji: 'tegami', meaning: 'Surat' },
                        { hiragana: 'とし', romaji: 'toshi', meaning: 'Kota' }
                    ]
                },
                part3: {
                    title: 'Bagian 3: Hiragana N-Series dan H-Series',
                    chars: { 'な': 'na', 'に': 'ni', 'ぬ': 'nu', 'ね': 'ne', 'の': 'no', 'は': 'ha', 'ひ': 'hi', 'ふ': 'fu', 'へ': 'he', 'ほ': 'ho' },
                    words: [
                        { hiragana: 'なつ', romaji: 'natsu', meaning: 'Musim panas' },
                        { hiragana: 'にほん', romaji: 'nihon', meaning: 'Jepang' },
                        { hiragana: 'ぬる', romaji: 'nuru', meaning: 'Mengecat' },
                        { hiragana: 'ねこ', romaji: 'neko', meaning: 'Kucing' },
                        { hiragana: 'のみもの', romaji: 'nomimono', meaning: 'Minuman' },
                        { hiragana: 'はし', romaji: 'hashi', meaning: 'Sumpit' },
                        { hiragana: 'ひる', romaji: 'hiru', meaning: 'Siang hari' },
                        { hiragana: 'ふね', romaji: 'fune', meaning: 'Kapal' },
                        { hiragana: 'へび', romaji: 'hebi', meaning: 'Ular' },
                        { hiragana: 'ほし', romaji: 'hoshi', meaning: 'Bintang' }
                    ]
                },
                part4: {
                    title: 'Bagian 4: Hiragana R-Series, M-Series, dan Lainnya',
                    chars: { 'ら': 'ra', 'り': 'ri', 'る': 'ru', 'れ': 're', 'ろ': 'ro', 'ま': 'ma', 'み': 'mi', 'む': 'mu', 'め': 'me', 'も': 'mo', 'わ': 'wa', 'を': 'wo', 'ん': 'n' },
                    words: [
                        { hiragana: 'らーめん', romaji: 'raamen', meaning: 'Ramen' },
                        { hiragana: 'りす', romaji: 'risu', meaning: 'Tupai' },
                        { hiragana: 'るすばん', romaji: 'rusuban', meaning: 'Menjaga rumah' },
                        { hiragana: 'れきし', romaji: 'rekishi', meaning: 'Sejarah' },
                        { hiragana: 'ろうか', romaji: 'rouka', meaning: 'Koridor' },
                        { hiragana: 'まくら', romaji: 'makura', meaning: 'Bantal' },
                        { hiragana: 'みせ', romaji: 'mise', meaning: 'Toko' },
                        { hiragana: 'むし', romaji: 'mushi', meaning: 'Serangga' },
                        { hiragana: 'めがね', romaji: 'megane', meaning: 'Kacamata' },
                        { hiragana: 'もり', romaji: 'mori', meaning: 'Hutan' }
                    ]
                },
                part5: {
                    title: 'Bagian 5: Dakuon dan Handokuon',
                    chars: { 'が': 'ga', 'ぎ': 'gi', 'ぐ': 'gu', 'げ': 'ge', 'ご': 'go', 'ざ': 'za', 'じ': 'ji', 'ず': 'zu', 'ぜ': 'ze', 'ぞ': 'zo', 'だ': 'da', 'ぢ': 'ji', 'づ': 'zu', 'で': 'de', 'ど': 'do', 'ば': 'ba', 'び': 'bi', 'ぶ': 'bu', 'べ': 'be', 'ぼ': 'bo', 'ぱ': 'pa', 'ぴ': 'pi', 'ぷ': 'pu', 'ぺ': 'pe', 'ぽ': 'po' },
                    words: [
                        { hiragana: 'がっこう', romaji: 'gakkou', meaning: 'Sekolah' },
                        { hiragana: 'ごみ', romaji: 'gomi', meaning: 'Sampah' },
                        { hiragana: 'じかん', romaji: 'jikan', meaning: 'Waktu' },
                        { hiragana: 'ぜんぜん', romaji: 'zenzen', meaning: 'Sama sekali tidak' },
                        { hiragana: 'だいがく', romaji: 'daigaku', meaning: 'Universitas' },
                        { hiragana: 'でんしゃ', romaji: 'densha', meaning: 'Kereta listrik' },
                        { hiragana: 'ばら', romaji: 'bara', meaning: 'Mawar' },
                        { hiragana: 'びん', romaji: 'bin', meaning: 'Botol' },
                        { hiragana: 'ぶた', romaji: 'buta', meaning: 'Babi' },
                        { hiragana: 'ぺん', romaji: 'pen', meaning: 'Pulpen' }
                    ]
                },
                // DATA BARU: Bagian 6 - PSAS GASAL
                part6: {
                    title: 'Bagian 6: PSAS GASAL (Mochimono, Aisatsu, Jikoshoukai, Angka 1-20)',
                    // Karakter yang dicampur (hanya untuk tampilan pengenalan)
                    chars: { 'い': 'i', 'ち': 'chi', 'さ': 'sa', 'ん': 'n', 'じゅ': 'ju', 'う': 'u', 'に': 'ni', 'は': 'ha', 'わ': 'wa', 'た': 'ta', 'し': 'shi', 'で': 'de', 'す': 'su' },
                    // Kata-kata PSAS GASAL
                    words: [
                        { hiragana: 'おはよう ございます', romaji: 'ohayou gozaimasu', meaning: 'Selamat Pagi' },
                        { hiragana: 'かばん', romaji: 'kaban', meaning: 'Tas' },
                        { hiragana: 'に', romaji: 'ni', meaning: 'Dua (2)' },
                        { hiragana: 'じゅう に', romaji: 'juuni', meaning: 'Dua Belas (12)' },
                        { hiragana: 'は じめまして', romaji: 'hajimemashite', meaning: 'Salam kenal' },
                        { hiragana: 'けしゴム', romaji: 'keshigomu', meaning: 'Penghapus' },
                        { hiragana: 'わたし', romaji: 'watashi', meaning: 'Saya' },
                        { hiragana: 'さようなら', romaji: 'sayounara', meaning: 'Selamat Tinggal' },
                        { hiragana: 'えんぴつ', romaji: 'enpitsu', meaning: 'Pensil' },
                        { hiragana: 'にじゅう', romaji: 'nijuu', meaning: 'Dua Puluh (20)' }
                    ]
                }
                // Akhir DATA BARU
            };
            
            const quizQuestions = {
                part1: [
                    { question: 'Apa romaji dari あ?', answer: 'a', options: ['a', 'i', 'u', 'e'] },
                    { question: 'Apa romaji dari こ?', answer: 'ko', options: ['ka', 'ki', 'ku', 'ko'] },
                    { question: 'Apa romaji dari う?', answer: 'u', options: ['o', 'e', 'u', 'i'] },
                    { question: 'Apa romaji dari か?', answer: 'ka', options: ['ku', 'ke', 'ka', 'ko'] },
                    { question: 'Apa romaji dari い?', answer: 'i', options: ['e', 'i', 'a', 'o'] },
                    { question: 'Apa romaji dari く?', answer: 'ku', options: ['ki', 'ka', 'ku', 'ke'] },
                    { question: 'Apa romaji dari お?', answer: 'o', options: ['a', 'i', 'o', 'e'] },
                    { question: 'Apa romaji dari き?', answer: 'ki', options: ['ko', 'ka', 'ki', 'ku'] },
                    { question: 'Apa romaji dari え?', answer: 'e', options: ['u', 'o', 'e', 'i'] },
                    { question: 'Apa romaji dari け?', answer: 'ke', options: ['ki', 'ke', 'ko', 'ka'] }
                ],
                part2: [
                    { question: 'Apa romaji dari さ?', answer: 'sa', options: ['shi', 'sa', 'su', 'so'] },
                    { question: 'Apa romaji dari と?', answer: 'to', options: ['te', 'ta', 'to', 'chi'] },
                    { question: 'Apa romaji dari し?', answer: 'shi', options: ['su', 'sa', 'so', 'shi'] },
                    { question: 'Apa romaji dari ち?', answer: 'chi', options: ['ta', 'chi', 'tsu', 'to'] },
                    { question: 'Apa romaji dari す?', answer: 'su', options: ['se', 'su', 'so', 'sa'] },
                    { question: 'Apa romaji dari つ?', answer: 'tsu', options: ['chi', 'te', 'tsu', 'to'] },
                    { question: 'Apa romaji dari せ?', answer: 'se', options: ['so', 'sa', 'se', 'shi'] },
                    { question: 'Apa romaji dari て?', answer: 'te', options: ['tsu', 'to', 'te', 'chi'] },
                    { question: 'Apa romaji dari そ?', answer: 'so', options: ['se', 'so', 'su', 'shi'] },
                    { question: 'Apa romaji dari た?', answer: 'ta', options: ['to', 'tsu', 'ta', 'chi'] }
                ],
                part3: [
                    { question: 'Apa romaji dari な?', answer: 'na', options: ['na', 'ni', 'nu', 'ne'] },
                    { question: 'Apa romaji dari ほ?', answer: 'ho', options: ['ha', 'hi', 'fu', 'he'] },
                    { question: 'Apa romaji dari に?', answer: 'ni', options: ['nu', 'ne', 'ni', 'na'] },
                    { question: 'Apa romaji dari は?', answer: 'ha', options: ['he', 'ho', 'ha', 'hi'] },
                    { question: 'Apa romaji dari ぬ?', answer: 'nu', options: ['ne', 'na', 'nu', 'no'] },
                    { question: 'Apa romaji dari ふ?', answer: 'fu', options: ['hi', 'ha', 'fu', 'he'] },
                    { question: 'Apa romaji dari ね?', answer: 'ne', options: ['no', 'nu', 'na', 'ne'] },
                    { question: 'Apa romaji dari へ?', answer: 'he', options: ['ho', 'fu', 'he', 'ha'] },
                    { question: 'Apa romaji dari の?', answer: 'no', options: ['na', 'ni', 'no', 'nu'] },
                    { question: 'Apa romaji dari ひ?', answer: 'hi', options: ['he', 'ha', 'hi', 'ho'] }
                ],
                part4: [
                    { question: 'Apa romaji dari ら?', answer: 'ra', options: ['ra', 'ri', 'ru', 're'] },
                    { question: 'Apa romaji dari も?', answer: 'mo', options: ['ma', 'mi', 'mu', 'mo'] },
                    { question: 'Apa romaji dari り?', answer: 'ri', options: ['re', 'ri', 'ro', 'ru'] },
                    { question: 'Apa romaji dari わ?', answer: 'wa', options: ['wo', 'wa', 'n', 're'] },
                    { question: 'Apa romaji dari る?', answer: 'ru', options: ['ro', 'ra', 'ru', 're'] },
                    { question: 'Apa romaji dari む?', answer: 'mu', options: ['me', 'mu', 'ma', 'mi'] },
                    { question: 'Apa romaji dari れ?', answer: 're', options: ['ri', 'ru', 'ro', 're'] },
                    { question: 'Apa romaji dari を?', answer: 'wo', options: ['wa', 'wo', 'n', 'mo'] },
                    { question: 'Apa romaji dari ろ?', answer: 'ro', options: ['ra', 'ri', 'ro', 'ru'] },
                    { question: 'Apa romaji dari ん?', answer: 'n', options: ['wa', 'wo', 'n', 'ri'] }
                ],
                part5: [
                    { question: 'Apa romaji dari が?', answer: 'ga', options: ['ga', 'ka', 'da', 'ba'] },
                    { question: 'Apa romaji dari ぱ?', answer: 'pa', options: ['ba', 'pa', 'da', 'ka'] },
                    { question: 'Apa romaji dari じ?', answer: 'ji', options: ['ji', 'di', 'bi', 'pi'] },
                    { question: 'Apa romaji dari ぞ?', answer: 'zo', options: ['zo', 'go', 'bo', 'po'] },
                    { question: 'Apa romaji dari ど?', answer: 'do', options: ['do', 'to', 'bo', 'po'] },
                    { question: 'Apa romaji dari び?', answer: 'bi', options: ['bi', 'pi', 'gi', 'ji'] },
                    { question: 'Apa romaji dari ぶ?', answer: 'bu', options: ['pu', 'bu', 'gu', 'zu'] },
                    { question: 'Apa romaji dari ぷ?', answer: 'pu', options: ['bu', 'gu', 'pu', 'du'] },
                    { question: 'Apa romaji dari げ?', answer: 'ge', options: ['ge', 'ze', 'de', 'pe'] },
                    { question: 'Apa romaji dari ぽ?', answer: 'po', options: ['bo', 'do', 'go', 'po'] }
                ],
                // DATA BARU: Kuis Bagian 6 - PSAS GASAL (30 Soal)
                part6: [
                    // Mochimono (10 Soal)
                    { question: 'Apa arti dari かばん?', answer: 'Tas', options: ['Buku', 'Pensil', 'Tas', 'Meja'] },
                    { question: 'Apa romaji dari ほ ん?', answer: 'hon', options: ['hono', 'hen', 'hon', 'huen'] },
                    { question: 'Apa arti dari けしゴム?', answer: 'Penghapus', options: ['Rautan', 'Penggaris', 'Penghapus', 'Buku Catatan'] },
                    { question: 'Pilih hiragana untuk "Pulpen"', answer: 'ぺん', options: ['ほん', 'ぺん', 'えんぴつ', 'かばん'] },
                    { question: 'Apa romaji dari じ しょ?', answer: 'jisho', options: ['gisho', 'jisho', 'zisho', 'shiso'] },
                    { question: 'Apa arti dari と けい?', answer: 'Jam Tangan', options: ['Kacamata', 'Jam Tangan', 'Handphone', 'Sepatu'] },
                    { question: 'Pilih hiragana untuk "Buku Catatan"', answer: 'のーと', options: ['かみ', 'のーと', 'じしょ', 'えんぴつ'] },
                    { question: 'Apa romaji dari ふ く?', answer: 'fuku', options: ['huku', 'hukku', 'fuku', 'puku'] },
                    { question: 'Apa arti dari ぼうし?', answer: 'Topi', options: ['Tas', 'Topi', 'Baju', 'Sepatu'] },
                    { question: 'Pilih hiragana untuk "Uang"', answer: 'おかね', options: ['おかね', 'かぎ', 'くつ', 'たけ'] },

                    // Angka 1-20 (10 Soal)
                    { question: 'Apa arti dari い ち?', answer: 'Satu', options: ['Dua', 'Tiga', 'Satu', 'Empat'] },
                    { question: 'Apa romaji dari ろ く?', answer: 'roku', options: ['roku', 'sichi', 'kyuu', 'juu'] },
                    { question: 'Pilih hiragana untuk "Delapan (8)"', answer: 'はち', options: ['なな', 'はち', 'きゅう', 'ご'] },
                    { question: 'Apa arti dari じゅう ご?', answer: 'Lima Belas', options: ['Sepuluh', 'Lima Belas', 'Dua Puluh', 'Enam Belas'] },
                    { question: 'Apa romaji dari じゅう に?', answer: 'juuni', options: ['juuichi', 'juuni', 'juusan', 'juuyo'] },
                    { question: 'Pilih hiragana untuk "Tiga Belas (13)"', answer: 'じゅう さん', options: ['じゅう いち', 'じゅう に', 'じゅう よん', 'じゅう さん'] },
                    { question: 'Apa arti dari な な?', answer: 'Tujuh', options: ['Lima', 'Enam', 'Tujuh', 'Delapan'] },
                    { question: 'Apa romaji dari に じゅう?', answer: 'nijuu', options: ['juuichi', 'nijuu', 'juu', 'sanjū'] },
                    { question: 'Pilih hiragana untuk "Sepuluh (10)"', answer: 'じゅう', options: ['ご', 'ろく', 'じゅう', 'に'] },
                    { question: 'Apa arti dari よ ん?', answer: 'Empat', options: ['Tiga', 'Empat', 'Lima', 'Dua'] },

                    // Aisatsu & Jikoshoukai (10 Soal)
                    { question: 'Apa arti dari こ ん ば ん は?', answer: 'Selamat Malam', options: ['Selamat Pagi', 'Selamat Siang', 'Selamat Malam', 'Selamat Tidur'] },
                    { question: 'Pilih hiragana untuk "Selamat Siang/Sore"', answer: 'こ ん に ち は', options: ['さようなら', 'こ ん に ち は', 'おやすみ', 'ありがとう'] },
                    { question: 'Apa romaji dari さ よ う な ら?', answer: 'sayounara', options: ['arigatou', 'ohayou', 'konbanwa', 'sayounara'] },
                    { question: 'Apa arti dari あ り が と う?', answer: 'Terima Kasih', options: ['Maaf', 'Permisi', 'Terima Kasih', 'Sama-sama'] },
                    { question: 'Pilih hiragana untuk "Salam Kenal"', answer: 'は じ め ま し て', options: ['こ ん に ち は', 'わたし', 'は じ め ま し て', 'よろしく'] },
                    { question: 'Apa arti dari ど う い た し ま し て?', answer: 'Sama-sama', options: ['Permisi', 'Sampai Jumpa', 'Sama-sama', 'Maaf'] },
                    { question: 'Pilih hiragana untuk "Saya Adalah..."', answer: 'わたし は ... で す', options: ['は じ め ま し て', 'わたし は ... で す', 'げんき で す', 'に ほ ん ご'] },
                    { question: 'Apa romaji dari す み ま せ ん?', answer: 'sumimasen', options: ['sayounara', 'sumimasen', 'oyasumi', 'konbanwa'] },
                    { question: 'Apa arti dari ど う ぞ よ ろ し く?', answer: 'Senang Bertemu Anda', options: ['Senang Bertemu Anda', 'Tolong Ambilkan', 'Selamat Pagi', 'Mari Makan'] },
                    { question: 'Pilih hiragana untuk "Selamat Tidur"', answer: 'お や す み な さ い', options: ['お は よ う', 'お や す み な さ い', 'こ ん ば ん は', 'さ よ う な ら'] }
                ]
                // Akhir DATA BARU
            };
            
            const menuCards = document.querySelectorAll('.card-menu');

            // Logika login
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const nis = document.getElementById('nis').value;
                
                // Mengganti penyimpanan di sessionStorage agar data user persisten saat refresh
                localStorage.setItem('loggedInUser', JSON.stringify({ username, nis }));
                
                showPage('home');
            });
            
            // Logika logout
            logoutButton.addEventListener('click', () => {
                localStorage.removeItem('loggedInUser');
                showPage('login');
                // Hentikan timer jika logout di tengah kuis
                clearInterval(timerInterval);
            });
            
            // Logika navigasi menu
            menuCards.forEach(card => {
                card.addEventListener('click', () => {
                    const partId = card.dataset.page;
                    loadPartPage(partId);
                });
            });

            // Logika tombol riwayat skor
            viewScoresButton.addEventListener('click', () => {
                showScores();
            });

            backFromScoresButton.addEventListener('click', () => {
                showPage('home');
            });

            // Logika tombol mulai kuis
            startQuizButton.addEventListener('click', () => {
                startQuiz();
            });

            // Logika tombol kembali dari kuis
            backFromQuizButton.addEventListener('click', () => {
                showPage('home');
            });
            
            // Logika tombol kembali dari halaman bagian
            backToHomePartButton.addEventListener('click', () => {
                showPage('home');
            });

            // Fungsi untuk menampilkan halaman
            function showPage(pageName) {
                // Sembunyikan semua halaman
                const allPages = [loginPage, homePage, scoresPage, partPageTemplate, quizPage];
                allPages.forEach(page => page.classList.add('hidden'));

                // Tampilkan halaman yang diminta
                if (pages[pageName]) {
                    pages[pageName].classList.remove('hidden');
                }
                
                if (pageName === 'home') {
                    // Mengambil dari localStorage
                    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
                    if (loggedInUser) {
                        userName.textContent = loggedInUser.username;
                    }
                }
            }

            // Fungsi untuk memuat halaman bagian
            function loadPartPage(partId) {
                const data = hiraganaData[partId];
                const hiraganaList = document.getElementById('hiragana-list');
                const wordList = document.getElementById('word-list');
                const partTitle = document.getElementById('part-title');
                
                partTitle.textContent = data.title;
                hiraganaList.innerHTML = '';
                wordList.innerHTML = '';

                // Tampilkan karakter Hiragana
                for (const char in data.chars) {
                    const card = document.createElement('div');
                    card.className = 'card p-4 text-center';
                    card.innerHTML = `<span class="kanji-display">${char}</span><p class="mt-2 text-xl font-semibold">${data.chars[char]}</p>`;
                    hiraganaList.appendChild(card);
                }
                
                // Tampilkan pengenalan kata
                data.words.forEach(word => {
                    const card = document.createElement('div');
                    card.className = 'card p-4';
                    card.innerHTML = `<p class="text-2xl font-bold">${word.hiragana}</p><p class="mt-1 text-lg text-gray-600">${word.romaji}</p><p class="mt-2 text-sm text-gray-500">Arti: ${word.meaning}</p>`;
                    wordList.appendChild(card);
                });

                startQuizButton.dataset.part = partId;
                
                showPage('part');
            }
            
            // Fungsi untuk memulai kuis
            function startQuiz() {
                const partId = startQuizButton.dataset.part;
                // Mengacak urutan soal sebelum memulai kuis
                currentQuizData = shuffleArray([...quizQuestions[partId]]); 
                currentQuizIndex = 0;
                correctAnswers = 0; // Reset jawaban benar
                
                quizTitle.textContent = `Kuis ${hiraganaData[partId].title.split(':')[1].trim()}`;
                quizResult.classList.add('hidden');
                quizContent.classList.remove('hidden');

                loadQuestion();
                showPage('quiz');
            }

            // Fungsi untuk mengacak array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Fungsi untuk memulai timer 20 detik
            function startTimer() {
                clearInterval(timerInterval); // Bersihkan timer yang sudah ada
                let timeLeft = QUESTION_DURATION;
                const timerProgress = document.getElementById('timer-progress');
                const timerDisplay = document.getElementById('timer-display');
                
                timerProgress.style.width = '100%';
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = `${timeLeft} detik tersisa`;
                    
                    // Update progress bar width
                    const percentage = (timeLeft / QUESTION_DURATION) * 100;
                    timerProgress.style.width = `${percentage}%`;

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timeOut();
                    }
                }, 1000);
            }
            
            // Fungsi jika waktu habis
            function timeOut() {
                // Lewati soal tanpa menambah skor
                console.log(`Waktu habis untuk soal ke ${currentQuizIndex + 1}. Soal dilewati.`);
                currentQuizIndex++;
                loadQuestion();
            }

            // Fungsi untuk memuat pertanyaan kuis
            function loadQuestion() {
                if (currentQuizIndex < currentQuizData.length) {
                    startTimer(); // Mulai timer untuk soal baru
                    
                    const question = currentQuizData[currentQuizIndex];
                    // Tampilkan nomor soal dan pertanyaan
                    questionText.textContent = `Soal ${currentQuizIndex + 1}/${currentQuizData.length}: ${question.question}`;
                    optionsContainer.innerHTML = '';
                    
                    // Mengacak opsi jawaban
                    const shuffledOptions = shuffleArray(question.options);

                    shuffledOptions.forEach(option => {
                        const button = document.createElement('button');
                        button.className = 'w-full bg-indigo-500 text-white p-3 rounded-md font-bold hover:bg-indigo-600 transition duration-300';
                        button.textContent = option;
                        // Tambahkan event listener untuk memeriksa jawaban
                        button.addEventListener('click', () => checkAnswer(option, question.answer));
                        optionsContainer.appendChild(button);
                    });
                } else {
                    endQuiz();
                }
            }

            // Fungsi untuk memeriksa jawaban
            function checkAnswer(selectedOption, correctAnswer) {
                clearInterval(timerInterval); // Hentikan timer segera setelah jawaban dipilih
                
                if (selectedOption === correctAnswer) {
                    correctAnswers++;
                }
                currentQuizIndex++;
                loadQuestion();
            }

            // Fungsi untuk mengakhiri kuis
            function endQuiz() {
                clearInterval(timerInterval); // Pastikan timer berhenti
                
                // Hitung skor akhir (Pembulatan ke atas)
                const finalScore = Math.round((correctAnswers / currentQuizData.length) * 100);

                quizContent.classList.add('hidden');
                quizResult.classList.remove('hidden');
                scoreDisplay.textContent = `${finalScore}/100`;

                // Simpan skor
                const partId = startQuizButton.dataset.part;
                saveScore(hiraganaData[partId].title, finalScore);
            }

            // Fungsi untuk menyimpan skor di localStorage
            function saveScore(title, finalScore) {
                let scores = JSON.parse(localStorage.getItem('hiraganaScores')) || [];
                const date = new Date().toLocaleDateString('id-ID');
                scores.push({ title, score: finalScore, date });
                localStorage.setItem('hiraganaScores', JSON.stringify(scores));
            }

            // Fungsi untuk menampilkan riwayat skor
            function showScores() {
                const scores = JSON.parse(localStorage.getItem('hiraganaScores')) || [];
                scoresTableBody.innerHTML = '';
                
                if (scores.length > 0) {
                    scores.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap">${entry.title}</td><td class="px-6 py-4 whitespace-nowrap">${entry.score}</td><td class="px-6 py-4 whitespace-nowrap">${entry.date}</td>`;
                        scoresTableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-gray-500">Belum ada skor yang tercatat.</td>`;
                    scoresTableBody.appendChild(row);
                }
                
                showPage('scores');
            }

            // Cek status login saat halaman dimuat
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                showPage('home');
            } else {
                showPage('login');
            }
        });
    </script>
</body>
</html>
